<!DOCTYPE html> <!-- MUST BE THE VERY FIRST LINE -->
<html lang="en">
<head>
    
    <!-- 
    ==============================================================================================
    HTML | HEAD SECTION: META, TITLE, FONTS, CSS

    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="application-version" content="1.2.4">
    <title>Text To Reader Utility</title>
    

    <!--  ASSET LINK |  Favicon Configuration   
    ------------------------------------------------------------------------------------------- -->
    <link rel="icon" type="image/svg+xml" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_01_-_NA_Favicon_-_SVG-h50mm.svg">
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_04_-_NA_Favicon_-_PNG-h512px.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_05_-_NA_Favicon_-_PNG-h192px.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_06_-_NA_Favicon_-_PNG-h32px.png">
    <link rel="icon" type="image/x-icon" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_07_-_NA_Favicon_-_ICO-h32px.ico">
    
    <!-- Main Noble Architecture Stylesheet -->
    <link rel="stylesheet" href="/assets/AD02_-_STYL_-_Common_-_StyleSheets/AD02_10_-_STYL_-_Core-Default-Stylesheet_-_Noble-Architecture.css">
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/src/js/header-version-injector.js"></script>

    <style>
        /* Root Font Size */
        :root {
            font-size           : 16.00px;
        }

        /* ===== PAGE STRUCTURE ===== */
        .PAGE__container {
            min-height          : 100vh;
            display             : flex;
            flex-direction      : column;
            overflow-x          : hidden;
            background-color    : var(--bg-color);
        }

        /* ===== HEADER ===== */
        .HEAD__container {
            background-color    : white;
            border-bottom       : 01px solid var(--card-border);
            padding             : 00.75rem 0;
            width               : 100%;
        }
        
        .HEAD__nav {
            max-width           : 960px;
            padding-left        : 01.00rem;
            padding-right       : 01.00rem;
            margin              : 0 auto;
            display             : flex;
            align-items         : center;
        }

        .HEAD__title {
            font-size           : 01.25rem;
            font-weight         : 600;
            color               : var(--primary-color);
        }

        .HEAD__version-note {
            font-size           : 00.75rem;
            color               : var(--text-light);
            font-weight         : normal;
            margin-left         : 00.50rem;
        }

        /* ===== MAIN CONTENT ===== */
        .FULL__page-app-container {
            width               : 100%;
            max-width           : 100%;
            margin              : 0 auto;
            padding             : 0;
            box-sizing          : border-box;
            flex                : 1;
            display             : flex;
            flex-direction      : column;
            overflow-y          : auto;
            background-color    : #f0f0f0;
        }

        .MAIN__container {
            width               : 100%;
            max-width           : 1000px;
            margin              : 1rem auto;
            padding             : 0 1rem;
            display             : flex;
            flex-direction      : column;
            gap                 : 01.00rem;
            box-sizing          : border-box;
        }

        /* ===== COMMON CARD BLOCKS ===== */
        .FORM__block, .CTRL__block, .RSLT__block {
            background-color    : white;
            border              : 01px solid var(--card-border);
            border-radius       : 00.3125rem;
            padding             : 01.00rem;
            margin-bottom       : 01.00rem;
        }

        /* ===== FORM ELEMENTS ===== */
        .FORM__label {
            display             : block;
            margin-bottom       : 00.50rem;
            font-weight         : 600;
            font-size           : 00.875rem;
            color               : var(--text-color);
        }
        
        .FORM__textarea {
            width               : 100%;
            height              : 20vh;
            min-height          : 08.00rem;
            padding             : 00.75rem;
            font-size           : 00.875rem;
            color               : var(--text-color);
            border              : 01px solid var(--card-border);
            border-radius       : 00.3125rem;
            box-sizing          : border-box;
            resize              : vertical;
            font-family         : monospace;
            line-height         : 1.6;
        }

        /* ===== CONTROL ELEMENTS ===== */
        .CTRL__block {
            position            : sticky;
            top                 : 0;
            z-index             : 10;
        }

        .CTRL__heading {
            font-size           : 01.00rem;
            font-weight         : 600;
            color               : var(--text-color);
            margin-bottom       : 01.00rem;
            padding-bottom      : 00.50rem;
            border-bottom       : 01px solid var(--card-border);
        }

        /* ===== BUTTONS ===== */
        .BTTN__container {
            display             : flex;
            flex-direction      : row;
            gap                 : 00.50rem;
            justify-content     : space-between;
        }
        
        .BTTN__standard {
            background-color    : var(--secondary-color);
            color               : white;
            border              : none;
            padding             : 00.625rem 01.25rem;
            border-radius       : 00.3125rem;
            cursor              : pointer;
            font-size           : 00.875rem;
            font-weight         : 600;
            transition          : background-color 0.2s, transform 0.1s;
            flex-grow           : 1;
        }
        
        .BTTN__standard:hover {
            background-color    : #005580;
        }
        
        .BTTN__standard:active {
            transform           : translateY(01px);
        }
        
        .BTTN__cancel {
            background-color    : #BA5050;
            color               : white;
            border              : none;
            padding             : 00.625rem 01.25rem;
            border-radius       : 00.3125rem;
            cursor              : pointer;
            font-size           : 00.875rem;
            font-weight         : 600;
            transition          : background-color 0.2s, transform 0.1s;
            flex-grow           : 1;
        }
        
        .BTTN__cancel:hover {
            background-color    : #9E2D2D;
        }
        
        .BTTN__cancel:active {
            transform           : translateY(01px);
        }

        /* ===== RESULTS AREA ===== */
        .RSLT__block {
            flex                : 1;
            min-height          : 30vh;
            display             : flex;
            flex-direction      : column;
            overflow            : hidden;
        }

        .MAIN__output {
            flex                : 1;
            overflow-y          : auto;
            padding             : 01.00rem;
            margin              : 0;
            border              : 01px solid var(--card-border);
            border-radius       : 00.3125rem;
            background-color    : white;
        }

        /* ===== MARKDOWN OUTPUT STYLING ===== */
        .MAIN__output p {
            margin              : 0 0 00.50rem 0;
        }

        .MAIN__output strong, .MAIN__output b {
            font-weight         : 600;
        }

        .MAIN__output em, .MAIN__output i {
            font-style          : italic;
            color               : var(--text-color);
        }

        .MAIN__output pre {
            background-color    : var(--code-bg);
            padding             : 00.625rem;
            border-radius       : 00.25rem;
            overflow-x          : auto;
            color               : var(--code-text);
        }

        .MAIN__output code {
            font-family         : monospace;
            background-color    : var(--code-bg);
            padding             : 0 00.20rem;
            border-radius       : 00.1875rem;
            color               : var(--code-text);
        }

        .MAIN__output pre code {
            padding             : 0;
            background-color    : transparent;
        }

        .MAIN__output blockquote {
            border-left         : 04px solid var(--card-border);
            padding-left        : 00.625rem;
            margin-left         : 0;
            color               : var(--text-light);
        }

        .MAIN__output ul, .MAIN__output ol {
            padding-left        : 01.5625rem;
            margin-bottom       : 00.15rem;
        }

        .MAIN__output li {
            margin-bottom       : 00.15rem;
            line-height         : 1.2;
        }

        /* ===== FOOTER ===== */
        .FOOT__container {
            padding             : 00.75rem;
            text-align          : center;
            background-color    : white;
            border-top          : 01px solid var(--card-border);
            font-size           : 00.75rem;
            color               : var(--text-light);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .FULL__page-app-container {
                padding         : 00.50rem;
                max-width       : 100%;
                height          : calc(100vh - 03.50rem);
            }

            .FORM__block,
            .CTRL__block,
            .RSLT__block {
                border-radius   : 0;
                border-left     : none;
                border-right    : none;
                padding         : 00.75rem;
            }

            .FORM__textarea {
                height          : 20vh;
            }

            .BTTN__container {
                flex-direction  : column;
            }
            
            .BTTN__standard,
            .BTTN__cancel {
                width           : 100%;
                margin-bottom   : 00.50rem;
            }

            .CTRL__block {
                position        : sticky;
                top             : 0;
                z-index         : 20;
                margin          : 0;
                box-shadow      : 0 02px 04px rgba(0, 0, 0, 0.1);
            }
        }
    </style>
</head>
<body>
    <!-- 
    =============================================================================================
    HTML | APP CONTAINER & HEADER
    - Introduced in v1.0.0 | Updated v1.2.1 | Refactored v1.2.3
    =============================================================================================
    -->
    <div class="PAGE__container">
        <header class="HEAD__container">
            <nav class="HEAD__nav">
                <span class="HEAD__title">Text To Reader Utility</span>
                <span class="HEAD__version-note">v1.2.4</span>
            </nav>
        </header>

        <div class="FULL__page-app-container">
            <!-- 
            =============================================================================================
            HTML | MAIN CONTENT: Input, Buttons, Output
            - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
            =============================================================================================
            -->
            <div class="MAIN__container">
                <!-- -----------------------------------------------------------------------------------------
                   HTML | INPUT AREA
                   - Introduced in v1.0.0 | Accessibility v1.2.2 | Updated v1.2.3
                   ----------------------------------------------------------------------------------------- -->
                <div class="FORM__block">
                    <label for="inputText" class="FORM__label">Input Text (WhatsApp or Markdown):</label> 
                    <textarea
                        id="inputText"
                        class="FORM__textarea"
                        placeholder="Paste your text (WhatsApp or Markdown) here..."
                    ></textarea>
                </div>

                <!-- -----------------------------------------------------------------------------------------
                   HTML | ACTION BUTTONS BLOCK
                   - Introduced in v1.0.0 | Updated v1.2.3 | Updated v1.2.4
                   ----------------------------------------------------------------------------------------- -->
                <div class="CTRL__block">
                    <h2 class="CTRL__heading">Actions</h2>
                    <div class="BTTN__container">
                        <button id="renderButton" type="button" class="BTTN__standard">Render Text</button>
                        <button id="clearButton" type="button" class="BTTN__cancel">Clear Text</button>
                    </div>
                </div>

                <!-- -----------------------------------------------------------------------------------------
                   HTML | OUTPUT AREA
                   - Introduced in v1.0.0 | Accessibility v1.2.2 | Updated v1.2.3
                   ----------------------------------------------------------------------------------------- -->
                <div class="RSLT__block">
                    <h2 class="CTRL__heading">Output</h2> 
                    <div 
                        id="output" 
                        class="MAIN__output"
                        role="region" 
                        aria-live="polite"
                    >
                        <!-- Rendered content will appear here -->
                    </div>
                </div>

            </div> <!-- End MAIN__container -->
        </div> <!-- End FULL__page-app-container -->

        <footer class="FOOT__container">
            &copy; 2025 Noble Architecture
        </footer>
    </div>


    <!-- Application Script -->
    <script>
        // Global DOM Elements
        const G_DOM_ELEMENTS = {
            inputText: null,
            renderButton: null,
            clearButton: null,
            output: null
        };

        // WhatsApp Message Parser
        function parseWhatsAppMessages(rawText) {
            const testPattern = /\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*/;

            if (!testPattern.test(rawText)) {
                return rawText;
            }
            
            const replacePattern = /\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*/g;
            
            let replaced = rawText.replace(replacePattern, "\n");
            replaced = replaced.replace(/\n{2,}/g, "\n");
            replaced = replaced.trim();
            replaced = replaced.split("\n").map(line => line.trim()).filter(line => line).join("\n- ");
            
            if (replaced) {
                replaced = "- " + replaced;
            }
            
            return replaced;
        }

        // Event Handlers
        function handleRenderClick(event) {
            event.preventDefault();
            
            if (!G_DOM_ELEMENTS.inputText || !G_DOM_ELEMENTS.output) return;
            if (typeof marked === 'undefined') {
                G_DOM_ELEMENTS.output.innerHTML = '<p style="color: red;">Error: Marked.js library failed to load.</p>';
                return;
            }

            const rawInput = G_DOM_ELEMENTS.inputText.value;
            const cleanedText = parseWhatsAppMessages(rawInput);

            try {
                const renderedHtml = marked.parse(cleanedText, { sanitize: true });
                G_DOM_ELEMENTS.output.innerHTML = renderedHtml;

                // Scroll to output on mobile
                if (window.innerWidth <= 768) {
                    G_DOM_ELEMENTS.output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } catch (error) {
                G_DOM_ELEMENTS.output.innerHTML = `<p style="color: red;">Error rendering Markdown: ${error.message}</p>`;
            }
        }

        function handleClearClick() {
            if (G_DOM_ELEMENTS.inputText) G_DOM_ELEMENTS.inputText.value = '';
            if (G_DOM_ELEMENTS.output) G_DOM_ELEMENTS.output.innerHTML = '';
        }

        // Application Initialization
        function initApp() {
            // Cache DOM elements
            G_DOM_ELEMENTS.inputText = document.getElementById('inputText');
            G_DOM_ELEMENTS.renderButton = document.getElementById('renderButton');
            G_DOM_ELEMENTS.clearButton = document.getElementById('clearButton');
            G_DOM_ELEMENTS.output = document.getElementById('output');

            // Check if all elements were found
            for (const key in G_DOM_ELEMENTS) {
                if (G_DOM_ELEMENTS[key] === null) {
                    console.error(`DOM element for '${key}' not found.`);
                    document.body.innerHTML = '<p style="color: red; font-weight: bold; padding: 20px;">Error: Essential HTML elements are missing.</p>';
                    return;
                }
            }

            // Attach event listeners
            G_DOM_ELEMENTS.renderButton.addEventListener('click', handleRenderClick);
            G_DOM_ELEMENTS.clearButton.addEventListener('click', handleClearClick);
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>