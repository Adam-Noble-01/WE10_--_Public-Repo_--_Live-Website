<!DOCTYPE html> <!-- MUST BE THE VERY FIRST LINE -->
<html lang="en">
<head>
    <!-- 
    ====================================================================================================================
    APPLICATION  |  Text To Reader Utility
    FILE NAME    |  RE20_10_01--_Web-App_-_Text-Utility_-_Reader-Tool.html
    FILE TYPE    |  HTML/CSS/JS Single-File Web Application
    APP DETAILS  |  A utility to parse WhatsApp chat text or render Markdown text into a readable format.
    AUTHOR       |  Adam Noble - Studio NoodlFjord
    VERSION      |  1.2.3
    ====================================================================================================================

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    SCRIPT DESCRIPTION

    This HTML file contains the complete code for the Text To Reader Utility.
    It integrates HTML, CSS, and JavaScript into a single file to provide functionalities including:
    - Text input area for pasting raw text (intended for WhatsApp chat exports or Markdown).
    - A parsing function (`parseWhatsAppMessages`) specifically designed to remove WhatsApp timestamp/sender prefixes (`[dd/mm, HH:MM] Sender Name: `).
    - If the text doesn't match the WhatsApp pattern, it's treated as standard Markdown.
    - Utilizes the third-party Marked.js library (via CDN) to render the cleaned or original text as HTML.
    - An output area displaying the rendered HTML.
    - Action buttons for rendering the text and clearing the input/output fields.
    - Adherence to the "RE10_20_01-_SCHEMA_-_Core-Web-Dev-Code-Conventions.txt" standard.
    - Dynamic injection of the application version (from meta tag) into the header title using the `injectVersionNote` helper function.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    ISSUES & LESSONS LEARNED  

    - WhatsApp Pattern Specificity: The `parseWhatsAppMessages` function relies on a specific regex pattern `\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*`. Changes in WhatsApp export format could break this parser. It assumes `[dd/mm, HH:MM] Name:` structure.
    - Marked.js Dependency: Relies on the external Marked.js library hosted on a CDN. If the CDN is unavailable or the library changes its API, rendering will fail.
    - Basic Parsing: The WhatsApp parsing is basic; it only removes the prefix. It doesn't handle other WhatsApp-specific formatting (like italics `_text_` or bold `*text*` differently than standard Markdown). Marked.js handles standard Markdown formatting after the prefix removal.
    - No Error Handling for Marked.js: If `marked.parse()` throws an error, it's not currently caught.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    PARSING LOGIC ARCHITECTURE

    1. Input Acquisition: User pastes text into `#inputText`.
    2. Render Trigger: User clicks `#renderButton`.
    3. WhatsApp Check: `handleRenderClick` calls `parseWhatsAppMessages` with the input text.
    4. Pattern Matching: `parseWhatsAppMessages` uses a regex (`testPattern`) to check if the input *looks like* a WhatsApp chat log (checks for at least one instance of the timestamp/sender prefix).
    5. Conditional Processing:
        - If Match: A second regex (`replacePattern`) globally removes all occurrences of the prefix, replacing them with double newlines (`\n\n`) to create paragraph breaks. Extra consecutive newlines are collapsed. The cleaned text is returned.
        - If No Match: The original input text is returned unmodified.
    6. Markdown Rendering: The text returned from `parseWhatsAppMessages` (either cleaned or original) is passed to `marked.parse()`.
    7. Output Display: The HTML string generated by `marked.parse()` is injected into the `#output` div's `innerHTML`.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    VISUAL JAVASCRIPT FUNCTION FLOW (Simplified)

    DOMContentLoaded -> initApp()
        ├── Cache DOM Elements (G_DOM_ELEMENTS)
        ├── injectVersionNote() -> Updates #app-title
        └── Attach Event Listeners
            ├── #renderButton -> handleRenderClick()
            │   └── parseWhatsAppMessages(inputText) -> cleanedText
            │   └── marked.parse(cleanedText) -> renderedHtml
            │   └── Update #output.innerHTML
            └── #clearButton -> handleClearClick()
                └── Clear #inputText, #output

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    FUTURE SCRIPT IMPROVEMENTS & IDEAS

    - More Robust WhatsApp Parsing: Handle variations in date/time format or potential name complexities.
    - Optional Formatting: Allow users to choose whether to keep/strip Markdown/WhatsApp formatting characters (*, _, ~).
    - Error Handling: Add `try...catch` around `marked.parse()` and provide user feedback on errors.
    - Syntax Highlighting: Potentially add syntax highlighting to the input textarea for Markdown.
    - Local Storage: Option to save/load input text.
    - Theme Options: Basic light/dark theme switcher.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    SCRIPT DEVELOPMENT & VERSION HISTORY TRACKER

    ??-???-???? - v1.0.0  |  Initial conceptual version (details assumed).
                        - Basic HTML structure.
                        - CSS styling.
                        - Core WhatsApp parsing logic.
                        - Marked.js integration.
                        - Render and Clear functionality.

    03-Apr-2025 - v1.2.1  |  CODE CONVENTION REFACTOR & VERSION INJECTION (Date is illustrative)
                        - Applied "RE10_20_01-_SCHEMA_-_Core-Web-Dev-Code-Conventions.txt".
                        - Added Master File Header comment block with full details.
                        - Added detailed region/sub-region comment blocks (HTML, CSS, JS).
                        - Added Application Version Meta Tag (`1.2.1`).
                        - Implemented dynamic version note injection into header title:
                            - Added `injectVersionNote` helper function.
                            - Added `G_DOM_ELEMENTS` for caching.
                            - Added `initApp` function for initialization.
                            - Added `DOMContentLoaded` listener.
                        - Refactored event listeners into named handler functions (`handleRenderClick`, `handleClearClick`).
                        - Updated version history tracking.
                        - Added Accessibility improvements (label for input, ARIA for output).

    07-Apr-2025 - v1.2.3  |  CSS STYLE GUIDE ALIGNMENT
                        - Refactored CSS to align with project style guide.
                        - Implemented proper block naming conventions (PAGE__, HEAD__, etc.).
                        - Converted pixel values to rem units.
                        - Added CSS variables for colors and other values.
                        - Applied column-like formatting for CSS properties.
                        - Updated HTML to use class-based selectors instead of IDs.
                        - Added responsive design improvements.
                        - Updated JavaScript to work with new class names.

    ??-???-???? - vX.Y.Z  |  LIST FUTURE UPDATES HERE

    ====================================================================================================================
    -->

    <!-- 
    =============================================================================================
    HTML | HEAD SECTION: META, TITLE, FONTS, CSS
    - Introduced in v1.0.0 | Updated v1.2.1 (Added Version Meta) | Updated v1.2.3
    Contains metadata (including application version), page title, font links, 
    and all CSS styles for the application.
    =============================================================================================
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Add Application Version Meta Tag -->
    <meta name="application-version" content="1.2.3"> <!-- ← CONFIG | Set Application Version Here -->
    <title>Text To Reader Utility</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600&display=swap" rel="stylesheet"> <!-- ← KEY LINK | Google Fonts Dependency -->
    
    <!--  - - - - - - - - - - - - - - - - - -  FAVICON CONFIGURATION  - - - - - - - - - - - - - - - - - - -->
    <!-- Primary SVG Favicon (Best for modern browsers) -->
    <link rel="icon" type="image/svg+xml" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_01_-_NA_Favicon_-_SVG-h50mm.svg">
    <!-- PNG Fallbacks for various resolutions -->
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_04_-_NA_Favicon_-_PNG-h512px.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_05_-_NA_Favicon_-_PNG-h192px.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_06_-_NA_Favicon_-_PNG-h32px.png">
    <!-- ICO Fallback for legacy browsers -->
    <link rel="icon" type="image/x-icon" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_07_-_NA_Favicon_-_ICO-h32px.ico">
    <!--  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    
    <style>
        /* =============================================================================================
           CSS | BASIC RESET & LAYOUT
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3 (Style Guide Alignment)
           ============================================================================================= */
        :root {
            --primary-color      :    #555041;          /*   <-- Brand color */
            --primary-hover      :    #3d392e;          /*   <-- Darker shade */
            --secondary-color    :    #86847d;          /*   <-- Neutral brand */
            --secondary-hover    :    #6c6a65;          /*   <-- Darker neutral */
            --success-color      :    #28a745;          /*   <-- Success state */
            --danger-color       :    #dc3545;          /*   <-- Error state */
            --danger-hover       :    #c82333;          /*   <-- Error hover */
            --card-bg            :    #ffffff;           /*   <-- Card background */
            --card-border        :    #ddd;              /*   <-- Card border */
            --code-bg            :    #3b3b3b;           /*   <-- Code block background */
            --code-text          :    #d9d9d9;           /*   <-- Code block text */
            --code-border        :    #444;              /*   <-- Code block border */
            --text-color         :    #333;              /*   <-- Primary text */
            --text-light         :    #666;              /*   <-- Secondary text */
            --body-bg            :    #f4f4f4;           /*   <-- Body background */
            --header-bg          :    #fff;              /*   <-- Header background */
            --header-border      :    var(--primary-color); /*   <-- Header border */
            --button-text        :    #fff;              /*   <-- Button text */
            --warning-bg         :    #fff3cd;           /*   <-- Warning background */
            --warning-border     :    #ffeeba;           /*   <-- Warning border */
            --warning-text       :    #856404;           /*   <-- Warning text */
            --header-height      :    55px;                /*   <-- Header height */
        }

        html, body {
            margin              :    0;
            padding             :    0;
            width               :    100%;
            min-height          :    100vh;
            background-color    :    var(--body-bg);
            font-family         :    'Open Sans', sans-serif;
            font-size           :    16.00px;            /*   <-- CRITICAL VALUE!!  */
            color               :    var(--text-color);
            line-height         :    1.40;
        }

        /* - - - - - - - - - - - - -   Page Container   - - - - - - - - - - - - - */
        .PAGE__container {
            width               :    100%;
            min-height          :    100vh;
            overflow-y          :    auto;
        }

        /* =============================================================================================
           CSS | HEADER COMPONENTS (Using HEAD__ Block)
           - Introduced in v1.0.0 | Updated v1.2.1 | Refactored v1.2.3
           ============================================================================================= */
        .HEAD__container {
            width               :    100%;
            height              :    var(--header-height);
            background          :    var(--header-bg);
            border-bottom       :    2px solid var(--header-border);
            display             :    flex;
            align-items         :    center;
            padding             :    0 01.25rem;
            box-sizing          :    border-box;
            position            :    sticky;
            top                 :    0;
            z-index             :    10;
        }

        .HEAD__title {
            font-size           :    01.375rem;
            color               :    var(--text-color);
            font-weight         :    600;
            display             :    flex;
            align-items         :    baseline;
            gap                 :    00.50rem;
        }

        .HEAD__version-note {
            /* Styles applied via JS */
        }

        /* =============================================================================================
           CSS | MAIN CONTENT AREA (Using MAIN__ Block)
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
           ============================================================================================= */
        .MAIN__container {
            width               :    90%;
            max-width           :    800px;
            margin              :    01.875rem auto;
            padding             :    01.5625rem;
            background-color    :    var(--card-bg);
            border-radius       :    00.50rem;
            box-shadow          :    0 2px 10px rgba(0,0,0,0.1);
        }

        /* =============================================================================================
           CSS | FORM COMPONENTS (Using FORM__ Block)
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
           ============================================================================================= */
        .FORM__label {
            display             :    block;
            margin-bottom       :    00.50rem;
            font-weight         :    600;
            font-size           :    00.875rem;
            color               :    var(--text-color);
            text-align          :    left;
        }
        
        .FORM__textarea {
            width               :    100%;
            height              :    15.625rem;
            padding             :    00.75rem;
            font-size           :    00.875rem;
            color               :    var(--text-color);
            border              :    1px solid var(--card-border);
            border-radius       :    00.3125rem;
            box-sizing          :    border-box;
            resize              :    vertical;
            font-family         :    monospace;
            line-height         :    1.6;
            margin-bottom       :    01.25rem;
        }

        /* =============================================================================================
           CSS | BUTTON COMPONENTS (Using BTTN__ Block)
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
           ============================================================================================= */
        .BTTN__container {
            display             :    flex;
            justify-content     :    flex-end;
            gap                 :    00.625rem;
            margin-top          :    00.625rem;
        }

        .BTTN__primary, .BTTN__danger {
            padding             :    00.625rem 01.25rem;
            font-size           :    00.875rem;
            border              :    none;
            color               :    var(--button-text);
            border-radius       :    00.25rem;
            cursor              :    pointer;
            transition          :    background-color 0.2s ease;
        }

        .BTTN__primary {
            background-color    :    var(--primary-color);
        }

        .BTTN__primary:hover {
            background-color    :    var(--primary-hover);
        }

        .BTTN__danger {
            background-color    :    var(--danger-color);
        }

        .BTTN__danger:hover {
            background-color    :    var(--danger-hover);
        }

        /* =============================================================================================
           CSS | OUTPUT COMPONENTS (Using MAIN__ Block)
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
           ============================================================================================= */
        .MAIN__output-heading {
            margin-top          :    01.875rem;
            margin-bottom       :    00.625rem;
            font-size           :    01.125rem;
            color               :    var(--text-color);
            text-align          :    left;
            border-bottom       :    1px solid var(--card-border);
            padding-bottom      :    00.3125rem;
        }
           
        .MAIN__output {
            padding             :    00.9375rem;
            border              :    1px solid var(--card-border);
            border-radius       :    00.3125rem;
            background-color    :    var(--body-bg);
            min-height          :    15.625rem;
            text-align          :    left;
            line-height         :    1.6;
            font-size           :    00.875rem;
            white-space         :    pre-wrap;
            word-wrap           :    break-word;
            overflow-y          :    auto;
        }

        /* - - - - - - - - - - - - -   Marked.js Output Styling   - - - - - - - - - - - - - */
        .MAIN__output p {
            margin              :    0 0 00.50rem 0;    /*   <-- Reduced paragraph margin */
        }

        .MAIN__output strong, .MAIN__output b {
            font-weight         :    600;
        }

        .MAIN__output em, .MAIN__output i {
            font-style          :    italic;
        }

        .MAIN__output pre {
            background-color    :    var(--code-bg);
            padding             :    00.625rem;
            border-radius       :    00.25rem;
            overflow-x          :    auto;
            color               :    var(--code-text);    /*   <-- Added code text color */
        }

        .MAIN__output code {
            font-family         :    monospace;
            background-color    :    var(--code-bg);
            padding-left        :    00.20rem;
            padding-right       :    00.20rem;
            border-radius       :    00.1875rem;
            color               :    var(--code-text);    /*   <-- Added code text color */
            margin-left         :    00.20rem;
            margin-right        :    00.20rem;
        }

        .MAIN__output pre code {
            padding             :    0;
            background-color    :    transparent;
            color              :    var(--code-text);    /*   <-- Ensure nested code maintains color */
        }

        .MAIN__output blockquote {
            border-left         :    4px solid var(--card-border);
            padding-left        :    00.625rem;
            margin-left         :    0;
            color               :    var(--text-light);
        }

        .MAIN__output ul, .MAIN__output ol {
            padding-left        :    01.5625rem;
            margin-bottom       :    00.15rem;          /*   <-- Added small top margin */
        }

        .MAIN__output li {
            margin-bottom       :    00.15rem;          /*   <-- Reduced list item spacing */
            line-height         :    1.2;               /*   <-- Tighter line height for lists */
        }

        .MAIN__output li:last-child {
            margin-bottom       :    0;                 /*   <-- Remove margin from last item */
        }

        /* =============================================================================================
           CSS | RESPONSIVE LAYOUTS
           - Introduced in v1.2.3
           ============================================================================================= */
        @media (max-width: 768px) {
            .MAIN__container {
                width               :    95%;
                padding             :    01.00rem;
                margin              :    01.00rem auto;
            }

            .BTTN__container {
                flex-direction       :    column;
            }

            .BTTN__primary, .BTTN__danger {
                width               :    100%;
            }
        }
    </style>
</head>
<body>
    <!-- 
    =============================================================================================
    HTML | APP CONTAINER & HEADER
    - Introduced in v1.0.0 | Updated v1.2.1 | Refactored v1.2.3
    =============================================================================================
    -->
    <div class="PAGE__container">
        <div class="HEAD__container">
            <span class="HEAD__title">Text To Reader Utility</span> 
        </div>

        <!-- 
        =============================================================================================
        HTML | MAIN CONTENT: Input, Buttons, Output
        - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
        =============================================================================================
        -->
        <div class="MAIN__container">

            <!-- -----------------------------------------------------------------------------------------
               HTML | INPUT AREA
               - Introduced in v1.0.0 | Accessibility v1.2.2 | Updated v1.2.3
               ----------------------------------------------------------------------------------------- -->
            <label for="inputText" class="FORM__label">Input Text (WhatsApp or Markdown):</label> 
            <textarea
                id="inputText"
                class="FORM__textarea"
                placeholder="Paste your text (WhatsApp or Markdown) here..."
            ></textarea>

            <!-- -----------------------------------------------------------------------------------------
               HTML | ACTION BUTTONS
               - Introduced in v1.0.0 | Updated v1.2.3
               ----------------------------------------------------------------------------------------- -->
            <div class="BTTN__container">
                <button id="renderButton" class="BTTN__primary">Render Text To Page</button>
                <button id="clearButton" class="BTTN__danger">Clear Text</button>
            </div>

            <!-- -----------------------------------------------------------------------------------------
               HTML | OUTPUT AREA
               - Introduced in v1.0.0 | Accessibility v1.2.2 | Updated v1.2.3
               ----------------------------------------------------------------------------------------- -->
            <h2 id="output-heading" class="MAIN__output-heading">Output</h2> 
            <div 
                id="output" 
                class="MAIN__output"
                role="region" 
                aria-live="polite" 
                aria-labelledby="output-heading"
            >
                <!-- Rendered content will appear here -->
            </div>

        </div> <!-- End MAIN__container -->
    </div> <!-- End PAGE__container -->

    <!-- 
    =============================================================================================
    JAVASCRIPT | THIRD-PARTY LIBRARIES
    - Introduced in v1.0.0
    =============================================================================================
    -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script> <!-- ← KEY LINK | Marked.js Dependency -->

    <!-- 
    =============================================================================================
    JAVASCRIPT | CORE APPLICATION SCRIPT
    - Introduced in v1.0.0 | Refactored v1.2.1
    =============================================================================================
    -->
    <script>
        // =============================================================================================
        // JAVASCRIPT | GLOBAL VARIABLES & CONSTANTS
        // - Introduced in v1.2.1 | Updated v1.2.3
        // Defines global constants and caches frequently accessed DOM elements.
        // =============================================================================================
        const G_DOM_ELEMENTS = {
            appTitle: null,
            inputText: null,
            renderButton: null,
            clearButton: null,
            output: null,
            // No need to cache outputHeading unless manipulated by JS
        };

        // =============================================================================================
        // JAVASCRIPT | HELPER FUNCTIONS
        // - Sections introduced as needed, refined in v1.2.1
        // Contains utility functions used by other parts of the script.
        // =============================================================================================

        // ------------------------------------------------------------
        // HELPER FUNCTION | PARSE WHATSAPP MESSAGES
        // - Introduced in v1.0.0 | Refactored v1.2.1
        // DESCRIPTION
        // - Attempts to detect and clean WhatsApp chat log prefixes.
        // - If the text matches the WhatsApp pattern, it removes the timestamp/sender
        //   prefixes (`[dd/mm, HH:MM] Sender Name: `) and replaces them with paragraph breaks.
        // - If no match, returns the original text for standard Markdown processing.
        // ARGUMENTS
        // - rawText (String): The input text from the textarea.
        // RETURNS
        // - (String): The cleaned text (if WhatsApp) or the original text.
        // IMPORTANT NOTES
        // - Relies on a specific regex pattern for detection and replacement.
        // ------------------------------------------------------------
        function parseWhatsAppMessages(rawText) {
            // Regex to test if the text *contains* the WhatsApp prefix pattern.
            const testPattern = /\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*/;

            // Check if the pattern exists anywhere in the text.
            if (!testPattern.test(rawText)) {
                console.log("Input doesn't match WhatsApp pattern, treating as Markdown.");
                return rawText;
            }
            
            console.log("WhatsApp pattern detected, attempting to clean prefixes.");
            // Regex to *globally replace* the WhatsApp prefix pattern.
            const replacePattern = /\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*/g;
            
            // Replace all occurrences of the prefix with a single newline
            let replaced = rawText.replace(replacePattern, "\n");
            
            // Collapse multiple consecutive newlines into just one
            replaced = replaced.replace(/\n{2,}/g, "\n");
            
            // Trim leading/trailing whitespace
            replaced = replaced.trim();

            // Convert single newlines to list items for better formatting
            replaced = replaced.split("\n").map(line => line.trim()).filter(line => line).join("\n- ");
            
            // Add initial list marker
            if (replaced) {
                replaced = "- " + replaced;
            }
            
            return replaced;
        }
        
        // ------------------------------------------------------------
        // HELPER FUNCTION | INJECT VERSION NOTE
        // - Introduced in v1.2.1 (Adapted from Regex Tool example)
        // DESCRIPTION
        // - Dynamically reads the application version from the meta tag and adds a styled
        //   version note into the application title element (#app-title).
        // ARGUMENTS
        // - options (Object, optional): Configuration options (see defaults inline).
        // IMPORTANT NOTES
        // - Assumes meta tag `name="application-version"` and element `#app-title` exist.
        // ------------------------------------------------------------
        function injectVersionNote(options = {}) {
             // --- Configuration with Defaults ---
            const config = {
                metaTagName: options.metaTagName || 'application-version',
                targetElementId: options.targetElementId || 'app-title',
                prefix: options.prefix !== undefined ? options.prefix : ' - Version ', // Adjusted prefix
                suffix: options.suffix !== undefined ? options.suffix : '', // No suffix by default
                style: options.style || {
                    fontSize: '12px',
                    color: '#656565',
                    fontWeight: 'normal' // Ensure normal weight
                }
            };

            // --- Find Target Element ---
            const targetElement = G_DOM_ELEMENTS.appTitle; // Use cached element
             if (!targetElement) {
                console.error(`Error: Target element #${config.targetElementId} not found for injecting version note.`);
                return;
            }

            // --- Get Version from Meta Tag ---
            const metaTag = document.querySelector(`meta[name="${config.metaTagName}"]`);
            if (!metaTag) {
                console.warn(`Warning: Meta tag with name="${config.metaTagName}" not found. Cannot inject version note.`);
                return;
            }
            const versionString = metaTag.getAttribute('content');
            if (!versionString) {
                 console.warn(`Warning: Meta tag "${config.metaTagName}" found, but has no content attribute. Cannot inject version note.`);
                return;
            }
            console.log(`Injecting version: ${versionString}`);

            // --- Get Base Title ---
            let baseTitle = '';
            for (let i = 0; i < targetElement.childNodes.length; i++) {
                if (targetElement.childNodes[i].nodeType === Node.TEXT_NODE) {
                    baseTitle = targetElement.childNodes[i].textContent.trim();
                    break;
                }
            }
             if (!baseTitle) { // Fallback
                 baseTitle = targetElement.textContent.split(config.prefix.trim())[0].trim() || 'App';
                 console.warn(`#${config.targetElementId} base text determined via fallback. Current text: "${targetElement.textContent}"`);
             }

            // --- Create the Version Note Span ---
            const versionSpan = document.createElement('span');
            versionSpan.className = 'HEAD__version-note';
            versionSpan.textContent = `${config.prefix}${versionString}${config.suffix}`;

            // --- Apply Styling ---
            for (const property in config.style) {
                if (config.style.hasOwnProperty(property)) {
                    versionSpan.style[property] = config.style[property];
                }
            }

            // --- Inject into DOM ---
            targetElement.innerHTML = ''; // Clear existing content
            targetElement.appendChild(document.createTextNode(baseTitle)); // Add base title text node
            targetElement.appendChild(versionSpan); // Append the new version span
        }

        // =============================================================================================
        // JAVASCRIPT | EVENT HANDLERS
        // - Introduced in v1.0.0 | Refactored into named functions in v1.2.1
        // Contains functions that handle specific user interactions (button clicks).
        // =============================================================================================

        // ------------------------------------------------------------
        // EVENT HANDLER | RENDER BUTTON CLICK
        // - Introduced in v1.0.0 | Refactored v1.2.1
        // DESCRIPTION
        // - Gets input text, attempts WhatsApp parsing, renders using Marked.js,
        //   and displays the result in the output area.
        // ------------------------------------------------------------
        function handleRenderClick() {
            if (!G_DOM_ELEMENTS.inputText || !G_DOM_ELEMENTS.output) {
                 console.error("Render handler: Input or output element missing.");
                 return;
            }
            if (typeof marked === 'undefined') {
                 console.error("Render handler: Marked.js library is not loaded.");
                 G_DOM_ELEMENTS.output.innerHTML = '<p style="color: red;">Error: Marked.js library failed to load. Cannot render text.</p>';
                 return;
            }

            // 1) Get raw input
            const rawInput = G_DOM_ELEMENTS.inputText.value;

            // 2) Attempt to parse as WhatsApp text (or get original back)
            const cleanedText = parseWhatsAppMessages(rawInput);

            try {
                // 3) Convert cleaned/original text to HTML via Marked.js
                // Configure marked to sanitize potentially harmful HTML
                const renderedHtml = marked.parse(cleanedText, { sanitize: true }); // Added basic sanitization

                // 4) Display result
                G_DOM_ELEMENTS.output.innerHTML = renderedHtml;
            } catch (error) {
                 console.error("Error during Marked.js parsing:", error);
                 G_DOM_ELEMENTS.output.innerHTML = `<p style="color: red;">Error rendering Markdown: ${error.message}</p>`;
            }
        }

        // ------------------------------------------------------------
        // EVENT HANDLER | CLEAR BUTTON CLICK
        // - Introduced in v1.0.0 | Refactored v1.2.1
        // DESCRIPTION
        // - Clears the content of the input textarea and the output display area.
        // ------------------------------------------------------------
        function handleClearClick() {
             if (G_DOM_ELEMENTS.inputText) {
                G_DOM_ELEMENTS.inputText.value = '';
             } else {
                 console.warn("Clear handler: Input element missing.");
             }
             if (G_DOM_ELEMENTS.output) {
                G_DOM_ELEMENTS.output.innerHTML = '';
             } else {
                 console.warn("Clear handler: Output element missing.");
             }
        }

        // =============================================================================================
        // INITIALIZATION | MAIN APPLICATION INIT
        // - Introduced in v1.2.1 | Updated v1.2.3
        // DESCRIPTION
        // - Sets up the application on page load: caches DOM elements, injects version note,
        //   and attaches global event listeners.
        // =============================================================================================
        function initApp() {
            console.log(`Initializing Text To Reader Utility v1.2.3...`); 

            // --- Cache DOM Elements ---
            G_DOM_ELEMENTS.appTitle = document.querySelector('.HEAD__title');
            G_DOM_ELEMENTS.inputText = document.getElementById('inputText');
            G_DOM_ELEMENTS.renderButton = document.getElementById('renderButton');
            G_DOM_ELEMENTS.clearButton = document.getElementById('clearButton');
            G_DOM_ELEMENTS.output = document.getElementById('output');

            // --- Check if all essential elements were found ---
            let essentialElementsFound = true;
             for (const key in G_DOM_ELEMENTS) {
                if (G_DOM_ELEMENTS[key] === null) {
                     console.error(`Initialization Error: DOM element for '${key}' not found.`);
                     essentialElementsFound = false;
                }
             }

             if (!essentialElementsFound) {
                 // Display a critical error message if essential elements are missing
                 document.body.innerHTML = '<p style="color: red; font-weight: bold; padding: 20px;">Error: Application could not initialize. Essential HTML elements are missing. Check the console for details.</p>';
                 return; // Stop initialization
             }
             
             // --- Inject Version Note ---
             injectVersionNote(); // Use default settings

            // --- Attach Global Event Listeners ---
            G_DOM_ELEMENTS.renderButton.addEventListener('click', handleRenderClick);
            G_DOM_ELEMENTS.clearButton.addEventListener('click', handleClearClick);

             console.log("Text To Reader Utility Initialized Successfully.");
        }

        // =============================================================================================
        // LISTENER | DOM CONTENT LOADED
        // - Introduced in v1.2.1
        // DESCRIPTION
        // - Ensures the DOM is fully parsed before running the main initialization script.
        // =============================================================================================
        document.addEventListener('DOMContentLoaded', initApp);

    </script>

</body>
</html>