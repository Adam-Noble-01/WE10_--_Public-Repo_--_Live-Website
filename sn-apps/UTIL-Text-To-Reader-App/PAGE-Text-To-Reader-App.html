<!DOCTYPE html> <!-- MUST BE THE VERY FIRST LINE -->
<html lang="en">
<head>
    <!-- 
    ====================================================================================================================
    APPLICATION  |  Text To Reader Utility
    FILE NAME    |  RE20_10_01--_Web-App_-_Text-Utility_-_Reader-Tool.html
    FILE TYPE    |  HTML/CSS/JS Single-File Web Application
    APP DETAILS  |  A utility to parse WhatsApp chat text or render Markdown text into a readable format.
    AUTHOR       |  Adam Noble - Studio NoodlFjord
    VERSION      |  1.2.4
    ====================================================================================================================

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    SCRIPT DESCRIPTION

    This HTML file contains the complete code for the Text To Reader Utility.
    It integrates HTML, CSS, and JavaScript into a single file to provide functionalities including:
    - Text input area for pasting raw text (intended for WhatsApp chat exports or Markdown).
    - A parsing function (`parseWhatsAppMessages`) specifically designed to remove WhatsApp timestamp/sender prefixes (`[dd/mm, HH:MM] Sender Name: `).
    - If the text doesn't match the WhatsApp pattern, it's treated as standard Markdown.
    - Utilizes the third-party Marked.js library (via CDN) to render the cleaned or original text as HTML.
    - An output area displaying the rendered HTML.
    - Action buttons for rendering the text and clearing the input/output fields.
    - Adherence to the "RE10_20_01-_SCHEMA_-_Core-Web-Dev-Code-Conventions.txt" standard.
    - Dynamic injection of the application version (from meta tag) into the header title using the `injectVersionNote` helper function.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    ISSUES & LESSONS LEARNED  

    - WhatsApp Pattern Specificity: The `parseWhatsAppMessages` function relies on a specific regex pattern `\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*`. Changes in WhatsApp export format could break this parser. It assumes `[dd/mm, HH:MM] Name:` structure.
    - Marked.js Dependency: Relies on the external Marked.js library hosted on a CDN. If the CDN is unavailable or the library changes its API, rendering will fail.
    - Basic Parsing: The WhatsApp parsing is basic; it only removes the prefix. It doesn't handle other WhatsApp-specific formatting (like italics `_text_` or bold `*text*` differently than standard Markdown). Marked.js handles standard Markdown formatting after the prefix removal.
    - No Error Handling for Marked.js: If `marked.parse()` throws an error, it's not currently caught.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    PARSING LOGIC ARCHITECTURE

    1. Input Acquisition: User pastes text into `#inputText`.
    2. Render Trigger: User clicks `#renderButton`.
    3. WhatsApp Check: `handleRenderClick` calls `parseWhatsAppMessages` with the input text.
    4. Pattern Matching: `parseWhatsAppMessages` uses a regex (`testPattern`) to check if the input *looks like* a WhatsApp chat log (checks for at least one instance of the timestamp/sender prefix).
    5. Conditional Processing:
        - If Match: A second regex (`replacePattern`) globally removes all occurrences of the prefix, replacing them with double newlines (`\n\n`) to create paragraph breaks. Extra consecutive newlines are collapsed. The cleaned text is returned.
        - If No Match: The original input text is returned unmodified.
    6. Markdown Rendering: The text returned from `parseWhatsAppMessages` (either cleaned or original) is passed to `marked.parse()`.
    7. Output Display: The HTML string generated by `marked.parse()` is injected into the `#output` div's `innerHTML`.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    VISUAL JAVASCRIPT FUNCTION FLOW (Simplified)

    DOMContentLoaded -> initApp()
        ├── Cache DOM Elements (G_DOM_ELEMENTS)
        ├── injectVersionNote() -> Updates #app-title
        └── Attach Event Listeners
            ├── #renderButton -> handleRenderClick()
            │   └── parseWhatsAppMessages(inputText) -> cleanedText
            │   └── marked.parse(cleanedText) -> renderedHtml
            │   └── Update #output.innerHTML
            └── #clearButton -> handleClearClick()
                └── Clear #inputText, #output

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    FUTURE SCRIPT IMPROVEMENTS & IDEAS

    - More Robust WhatsApp Parsing: Handle variations in date/time format or potential name complexities.
    - Optional Formatting: Allow users to choose whether to keep/strip Markdown/WhatsApp formatting characters (*, _, ~).
    - Error Handling: Add `try...catch` around `marked.parse()` and provide user feedback on errors.
    - Syntax Highlighting: Potentially add syntax highlighting to the input textarea for Markdown.
    - Local Storage: Option to save/load input text.
    - Theme Options: Basic light/dark theme switcher.

    - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
    SCRIPT DEVELOPMENT & VERSION HISTORY TRACKER

    ??-???-???? - v1.0.0  |  Initial conceptual version (details assumed).
                        - Basic HTML structure.
                        - CSS styling.
                        - Core WhatsApp parsing logic.
                        - Marked.js integration.
                        - Render and Clear functionality.

    03-Apr-2025 - v1.2.1  |  CODE CONVENTION REFACTOR & VERSION INJECTION (Date is illustrative)
                        - Applied "RE10_20_01-_SCHEMA_-_Core-Web-Dev-Code-Conventions.txt".
                        - Added Master File Header comment block with full details.
                        - Added detailed region/sub-region comment blocks (HTML, CSS, JS).
                        - Added Application Version Meta Tag (`1.2.1`).
                        - Implemented dynamic version note injection into header title:
                            - Added `injectVersionNote` helper function.
                            - Added `G_DOM_ELEMENTS` for caching.
                            - Added `initApp` function for initialization.
                            - Added `DOMContentLoaded` listener.
                        - Refactored event listeners into named handler functions (`handleRenderClick`, `handleClearClick`).
                        - Updated version history tracking.
                        - Added Accessibility improvements (label for input, ARIA for output).

    07-Apr-2025 - v1.2.3  |  CSS STYLE GUIDE ALIGNMENT
                        - Refactored CSS to align with project style guide.
                        - Implemented proper block naming conventions (PAGE__, HEAD__, etc.).
                        - Converted pixel values to rem units.
                        - Added CSS variables for colors and other values.
                        - Applied column-like formatting for CSS properties.
                        - Updated HTML to use class-based selectors instead of IDs.
                        - Added responsive design improvements.
                        - Updated JavaScript to work with new class names.

    08-Apr-2025 - v1.2.4  |  STYLESHEET OPTIMISATION
                        - Integrated with main Noble Architecture stylesheet.
                        - Removed duplicate styles.
                        - Added proper font-face declarations.
                        - Ensured consistent naming conventions.
                        - Reduced application size by leveraging shared styles.

    ??-???-???? - vX.Y.Z  |  LIST FUTURE UPDATES HERE

    ====================================================================================================================
    -->

    <!-- 
    =============================================================================================
    HTML | HEAD SECTION: META, TITLE, FONTS, CSS
    - Introduced in v1.0.0 | Updated v1.2.1 (Added Version Meta) | Updated v1.2.3 | Updated v1.2.4
    Contains metadata (including application version), page title, font links, 
    and all CSS styles for the application.
    =============================================================================================
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Add Application Version Meta Tag -->
    <meta name="application-version" content="1.2.4"> <!-- ← CONFIG | Set Application Version Here -->
    <title>Text To Reader Utility</title>
    
    <!--  - - - - - - - - - - - - - - - - - -  FAVICON CONFIGURATION  - - - - - - - - - - - - - - - - - - -->
    <!-- Primary SVG Favicon (Best for modern browsers) -->
    <link rel="icon" type="image/svg+xml" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_01_-_NA_Favicon_-_SVG-h50mm.svg">
    <!-- PNG Fallbacks for various resolutions -->
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_04_-_NA_Favicon_-_PNG-h512px.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_05_-_NA_Favicon_-_PNG-h192px.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_06_-_NA_Favicon_-_PNG-h32px.png">
    <!-- ICO Fallback for legacy browsers -->
    <link rel="icon" type="image/x-icon" href="/assets/AD05_-_LIBR_-_Common_-_Icons-and-favicons/AD05_07_-_NA_Favicon_-_ICO-h32px.ico">
    <!--  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    
    <!--  - - - - - - - - - - - - - - - - - -  STYLESHEET CONFIGURATION  - - - - - - - - - - - - - - - - - - -->
    <!-- Main Noble Architecture Stylesheet -->
    <link rel="stylesheet" href="/assets/AD02_-_STYL_-_Common_-_StyleSheets/AD02_10_-_STYL_-_Core-Default-Stylesheet_-_Noble-Architecture.css">
    <!--  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -->
    
    <!-- 
    =============================================================================================
    JAVASCRIPT | THIRD-PARTY LIBRARIES & UTILITIES
    - Introduced in v1.0.0 | Updated v1.2.4
    Contains external dependencies and utility scripts required by the application.
    =============================================================================================
    -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="/src/js/header-version-injector.js"></script>


    <style>
        /* =============================================================================================
           CSS | ROOT FONT SIZE DEFINITION
           - Introduced in v1.2.4
           Establishes the base for rem units (1rem = 16px)
           ============================================================================================= */
        :root {
            font-size           :    16px;
        }

        /* =============================================================================================
           CSS | APP-SPECIFIC STYLES
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3 | Updated v1.2.4
           ============================================================================================= */
        
        /* =============================================================================================
           CSS | HEADER COMPONENTS
           - Introduced in v1.2.4
           ============================================================================================= */
        .HEAD__nav {
            max-width          :    90%;
            padding-left       :    2rem;
            padding-right      :    2rem;
            margin            :    0 auto;
        }

        .HEAD__version-note {
            font-size          :    0.75rem;
            color              :    var(--text-light);
            font-weight        :    normal;
            margin-left        :    0.5rem;
        }

        /* =============================================================================================
           CSS | FULL PAGE APP CONTAINER
           - Introduced in v1.2.4
           ============================================================================================= */
        .FULL__page-app-container {
            width              :    100%;
            max-width          :    90%;
            margin             :    0 auto;
            padding            :    2rem;
            box-sizing         :    border-box;
            flex               :    1;
            display            :    flex;
            flex-direction     :    column;
        }

        /* =============================================================================================
           CSS | MAIN CONTAINER
           - Introduced in v1.2.4
           ============================================================================================= */
        .MAIN__container {
            width             :    100%;
            max-width         :    100%;
            margin           :    0 auto;
        }

        /* =============================================================================================
           CSS | BUTTON CONTAINER
           - Introduced in v1.2.4
           ============================================================================================= */
        .BTTN__container {
            display             :    flex;
            gap                 :    01.00rem;
            margin-bottom       :    01.25rem;
            justify-content     :    center; /* Center buttons horizontally */
        }
        
        /* =============================================================================================
           CSS | FORM COMPONENTS (Using FORM__ Block)
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
           ============================================================================================= */
        .FORM__label {
            display             :    block;
            margin-bottom       :    00.50rem;
            font-weight         :    600;
            font-size           :    00.875rem;
            color               :    var(--text-color);
            text-align          :    left;
        }
        
        .FORM__textarea {
            width               :    100%;
            height              :    15.625rem;
            padding             :    00.75rem;
            font-size           :    00.875rem;
            color               :    var(--text-color);
            border              :    1px solid var(--card-border);
            border-radius       :    00.3125rem;
            box-sizing          :    border-box;
            resize              :    vertical;
            font-family         :    monospace;
            line-height         :    1.6;
            margin-bottom       :    01.25rem;
        }

        /* =============================================================================================
           CSS | OUTPUT COMPONENTS (Using MAIN__ Block)
           - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
           ============================================================================================= */
        .MAIN__output-container {
            position           :    relative;
            background-color   :    #FFFFFF;
            margin-bottom      :    2rem;
            overflow-y         :    auto;
            max-height         :    70vh;
        }

        .MAIN__output-heading {
            margin-top          :    01.875rem;
            margin-bottom       :    00.625rem;
            font-size           :    01.125rem;
            color               :    var(--text-color);
            text-align          :    left;
            border-bottom       :    1px solid var(--card-border);
            padding-bottom      :    00.3125rem;
        }
           
        .MAIN__output {
            padding             :    00.9375rem;
            border              :    1px solid var(--card-border);
            border-radius       :    00.3125rem;
            background-color    :    #FFFFFF;
            text-align          :    left;
            line-height         :    1.6;
            font-size           :    00.875rem;
            white-space         :    pre-wrap;
            word-wrap           :    break-word;
            box-shadow          :    0 1px 3px rgba(0, 0, 0, 0.05);
        }

        /* - - - - - - - - - - - - -   Marked.js Output Styling   - - - - - - - - - - - - - */
        .MAIN__output p {
            margin              :    0 0 00.50rem 0;
        }

        .MAIN__output strong, .MAIN__output b {
            font-weight         :    600;
        }

        .MAIN__output em, .MAIN__output i {
            font-family         :    var(--font-primary);
            color              :    var(--text-color);
            font-weight        :    500;
        }

        .MAIN__output pre {
            background-color    :    var(--code-bg);
            padding             :    00.625rem;
            border-radius       :    00.25rem;
            overflow-x          :    auto;
            color               :    var(--code-text);
        }

        .MAIN__output code {
            font-family         :    monospace;
            background-color    :    var(--code-bg);
            padding-left        :    00.20rem;
            padding-right       :    00.20rem;
            border-radius       :    00.1875rem;
            color               :    var(--code-text);
            margin-left         :    00.20rem;
            margin-right        :    00.20rem;
        }

        .MAIN__output pre code {
            padding             :    0;
            background-color    :    transparent;
            color              :    var(--code-text);
        }

        .MAIN__output blockquote {
            border-left         :    4px solid var(--card-border);
            padding-left        :    00.625rem;
            margin-left         :    0;
            color               :    var(--text-light);
        }

        .MAIN__output ul, .MAIN__output ol {
            padding-left        :    01.5625rem;
            margin-bottom       :    00.15rem;
        }

        .MAIN__output li {
            margin-bottom       :    00.15rem;
            line-height         :    1.2;
        }

        .MAIN__output li:last-child {
            margin-bottom       :    0;
        }

        /* =============================================================================================
           CSS | APP-SPECIFIC RESPONSIVE LAYOUTS
           - Introduced in v1.2.3 | Updated v1.2.4
           ============================================================================================= */
        @media (max-width: 768px) {
            .BTTN__container {
                flex-direction       :    column;
                position            :    sticky;
                top                 :    0;
                background-color    :    #FFFFFF;
                z-index            :    20;
                padding            :    0.5rem 0;
            }

            .BTTN__standard, .BTTN__cancel {
                width               :    100%;
            }
            
            /* Add mobile-specific styling for the textarea */
            .FORM__textarea {
                height              :    10rem; /* Reduce height on mobile */
                font-size           :    1rem; /* Increase font size for better readability */
                padding             :    0.5rem; /* Reduce padding */
            }
            
            /* Ensure the container has proper padding on mobile */
            .FULL__page-app-container {
                padding            :    1rem 0.5rem;
            }

            /* Simple flex layout for content */
            .PAGE__container {
                display           :    flex;
                flex-direction    :    column;
            }

            /* Ensure output is always visible on mobile */
            .MAIN__output-container {
                position         :    relative;
                margin-bottom   :    1rem;
                max-height      :    60vh;
            }
        }
    </style>
</head>
<body>
    <!-- 
    =============================================================================================
    HTML | APP CONTAINER & HEADER
    - Introduced in v1.0.0 | Updated v1.2.1 | Refactored v1.2.3
    =============================================================================================
    -->
    <div class="PAGE__container">
        <header class="HEAD__container">
            <nav class="HEAD__nav">
                <span class="HEAD__title">Text To Reader Utility</span>
            </nav>
        </header>

        <div class="FULL__page-app-container">
            <!-- 
            =============================================================================================
            HTML | MAIN CONTENT: Input, Buttons, Output
            - Introduced in v1.0.0 | Refactored v1.2.1 | Updated v1.2.3
            =============================================================================================
            -->
            <div class="MAIN__container">

                <!-- -----------------------------------------------------------------------------------------
                   HTML | INPUT AREA
                   - Introduced in v1.0.0 | Accessibility v1.2.2 | Updated v1.2.3
                   ----------------------------------------------------------------------------------------- -->
                <label for="inputText" class="FORM__label">Input Text (WhatsApp or Markdown):</label> 
                <textarea
                    id="inputText"
                    class="FORM__textarea"
                    placeholder="Paste your text (WhatsApp or Markdown) here..."
                ></textarea>

                <!-- -----------------------------------------------------------------------------------------
                   HTML | ACTION BUTTONS
                   - Introduced in v1.0.0 | Updated v1.2.3 | Updated v1.2.4
                   ----------------------------------------------------------------------------------------- -->
                <div class="BTTN__container">
                    <button id="renderButton" type="button" class="BTTN__standard">Render Text To Page</button>
                    <button id="clearButton" type="button" class="BTTN__cancel">Clear Text</button>
                </div>

                <!-- -----------------------------------------------------------------------------------------
                   HTML | OUTPUT AREA
                   - Introduced in v1.0.0 | Accessibility v1.2.2 | Updated v1.2.3
                   ----------------------------------------------------------------------------------------- -->
                <div class="MAIN__output-container">
                    <h2 id="output-heading" class="MAIN__output-heading">Output</h2> 
                    <div 
                        id="output" 
                        class="MAIN__output"
                        role="region" 
                        aria-live="polite" 
                        aria-labelledby="output-heading"
                    >
                        <!-- Rendered content will appear here -->
                    </div>
                </div>

            </div> <!-- End MAIN__container -->
        </div> <!-- End FULL__page-app-container -->

        <footer class="FOOT__container">
            &copy; 2025 Noble Architecture
        </footer>
    </div>


    <!-- Application Script -->
    <script>
        // Global Variables & Constants
        const G_DOM_ELEMENTS = {
            inputText: null,
            renderButton: null,
            clearButton: null,
            output: null,
            outputHeading: null
        };

        // Helper Functions
        function parseWhatsAppMessages(rawText) {
            const testPattern = /\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*/;

            if (!testPattern.test(rawText)) {
                console.log("Input doesn't match WhatsApp pattern, treating as Markdown.");
                return rawText;
            }
            
            console.log("WhatsApp pattern detected, attempting to clean prefixes.");
            const replacePattern = /\[\d{1,2}\/\d{1,2},\s*\d{1,2}:\d{2}\]\s*[^:]+:\s*/g;
            
            let replaced = rawText.replace(replacePattern, "\n");
            replaced = replaced.replace(/\n{2,}/g, "\n");
            replaced = replaced.trim();
            replaced = replaced.split("\n").map(line => line.trim()).filter(line => line).join("\n- ");
            
            if (replaced) {
                replaced = "- " + replaced;
            }
            
            return replaced;
        }

        // Event Handlers
        function handleRenderClick(event) {
            event.preventDefault();
            
            if (!G_DOM_ELEMENTS.inputText || !G_DOM_ELEMENTS.output) {
                 console.error("Render handler: Input or output element missing.");
                return;
            }
            if (typeof marked === 'undefined') {
                 console.error("Render handler: Marked.js library is not loaded.");
                G_DOM_ELEMENTS.output.innerHTML = '<p style="color: red;">Error: Marked.js library failed to load. Cannot render text.</p>';
                return;
            }

            const rawInput = G_DOM_ELEMENTS.inputText.value;
            const cleanedText = parseWhatsAppMessages(rawInput);

            try {
                const renderedHtml = marked.parse(cleanedText, { sanitize: true });
                G_DOM_ELEMENTS.output.innerHTML = renderedHtml;

                const outputRect = G_DOM_ELEMENTS.output.getBoundingClientRect();
                if (outputRect.bottom > window.innerHeight) {
                    G_DOM_ELEMENTS.output.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }
            } catch (error) {
                 console.error("Error during Marked.js parsing:", error);
                G_DOM_ELEMENTS.output.innerHTML = `<p style="color: red;">Error rendering Markdown: ${error.message}</p>`;
            }
        }

        function handleClearClick() {
             if (G_DOM_ELEMENTS.inputText) {
                G_DOM_ELEMENTS.inputText.value = '';
            } else {
                console.warn("Clear handler: Input element missing.");
            }
            if (G_DOM_ELEMENTS.output) {
                G_DOM_ELEMENTS.output.innerHTML = '';
            } else {
                console.warn("Clear handler: Output element missing.");
            }
        }

        // Application Initialization
        function initApp() {
            console.log(`Initializing Text To Reader Utility v1.2.4...`); 
            
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            console.log(`Device type: ${isMobile ? 'Mobile' : 'Desktop'}`);
            console.log(`Screen width: ${window.innerWidth}px, Screen height: ${window.innerHeight}px`);
            console.log(`User agent: ${navigator.userAgent}`);

            G_DOM_ELEMENTS.inputText = document.getElementById('inputText');
            G_DOM_ELEMENTS.renderButton = document.getElementById('renderButton');
            G_DOM_ELEMENTS.clearButton = document.getElementById('clearButton');
            G_DOM_ELEMENTS.output = document.getElementById('output');
            G_DOM_ELEMENTS.outputHeading = document.getElementById('output-heading');

            console.log('DOM Elements found:');
            for (const key in G_DOM_ELEMENTS) {
                console.log(`- ${key}: ${G_DOM_ELEMENTS[key] ? 'Found' : 'Not found'}`);
            }

            let essentialElementsFound = true;
            for (const key in G_DOM_ELEMENTS) {
                if (G_DOM_ELEMENTS[key] === null && key !== 'outputHeading') {
                    console.error(`Initialization Error: DOM element for '${key}' not found.`);
                    essentialElementsFound = false;
                }
            }

            if (!essentialElementsFound) {
                document.body.innerHTML = '<p style="color: red; font-weight: bold; padding: 20px;">Error: Application could not initialize. Essential HTML elements are missing. Check the console for details.</p>';
                return;
            }
              
            try {
                injectVersionNote();
            } catch (error) {
                console.error('Error injecting version note:', error);
            }

            try {
                G_DOM_ELEMENTS.renderButton.addEventListener('click', handleRenderClick);
                G_DOM_ELEMENTS.clearButton.addEventListener('click', handleClearClick);
                console.log('Event listeners attached successfully');
            } catch (error) {
                console.error('Error attaching event listeners:', error);
            }

            console.log("Text To Reader Utility Initialized Successfully.");
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>